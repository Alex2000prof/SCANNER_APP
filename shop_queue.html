<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–µ—Ä–µ–Ω–æ—Å —Ç–æ–≤–∞—Ä–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º SweetAlert2 –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"> -->


  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');
    html, body {
      font-family: 'Montserrat', sans-serif;
    }
    html, body {
    overflow-x: hidden;
    margin: 0;
    padding: 0;
   }
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap');
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
    .transfer-container {
      width: 90%;
      max-width: 600px;
      background: #fff;
      border: 1px solid #ff3c00;
      border-radius: 0px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      position: relative;
      padding: 20px 20px 60px 20px;
    }
    /* Info-–∫–Ω–æ–ø–∫–∞ –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É */
    .info-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, #ff3c00, #ff7733);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.5em;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background 0.3s;
      z-index: 3;
    }
    .info-icon:hover {
      background: linear-gradient(135deg, #e04400, #ff5733);
    }
    /* Popup —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π */
    .info-popup {
      display: none;
      position: absolute;
      top: 60px;
      right: 10px;
      background: linear-gradient(135deg, #fff, #f0f0f0);
      border: 2px solid #ff3c00;
      border-radius: 8px;
      padding: 10px;
      width: 260px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 3;
    }
    .info-popup h3 {
      margin: 0 0 5px;
      font-size: 1.2em;
      color: #ff3c00;
    }
    .info-popup p {
      margin: 3px 0;
      font-size: 1em;
      color: #333;
    }
    .info-popup .close-popup {
      position: absolute;
      top: 5px;
      right: 5px;
      background: none;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
      color: #ff3c00;
    }
    .header-info {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid #ccc;
    }

    .static-header {
      font-size: 2em;
      color: #ff3c00;
      line-height: 1.1;  /* —á—É—Ç—å –ø–ª–æ—Ç–Ω–µ–µ —Å—Ç—Ä–æ–∫–∏ */
      text-align: center;
    }

    .warehouse-task-number,
    .doc-info,
    .remaining-tasks {
      font-size: 1.2em;
      margin: 3px 0;
      color: #333;
      font-weight: 600;
    }
    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ */
    .product-info {
      text-align: center;
      font-size: 1.2em;
      color: #555;
      margin-bottom: 10px;
    }
    .product-info span {
      display: block;
    }
    /* –°–µ–∫—Ü–∏–∏ */
    .transfer-section {
      margin-bottom: 15px;
      padding: 20px;
      background: linear-gradient(135deg, #fafafa, #f0f0f0);
      border: 2px solid #ccc;
      border-radius: 8px;
      transition: border-color 0.3s, background 0.3s, color 0.3s;
      position: relative;
    }
    .transfer-section.active {
      border-color: #FFD700;
      background: linear-gradient(135deg, #fff8e1, #fff3cd);
      color: #444;
    }
    .transfer-section.confirmed {
      color: #333 !important;
      border-color: #28a745;
      background: linear-gradient(135deg, #eaffea, #d4f7d4);
      color: #fff;
    }
    .transfer-section h2 {
      margin: 0 0 10px;
      font-size: 1.4em;
      color: inherit;
      text-align: center;
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
    }

    /* –†—É—á–Ω–æ–π –≤–≤–æ–¥ */
    .manual-input {
      display: none;
      margin-top: 10px;
      text-align: center;
    }
    .manual-input input {
      padding: 8px;
      font-size: 1em;
      border: 2px solid #ff3c00;
      border-radius: 4px;
      width: 60%;
      margin-bottom: 5px;
    }
    .manual-input button {
      padding: 8px 15px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 5px;
      background: linear-gradient(135deg, #FF3366, #FF7733);
      color: #fff;
      transition: background 0.3s;
    }
    .manual-input button:hover {
      background: linear-gradient(135deg, #FF2255, #FF6633);
    }
    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ */
    .info-block {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1em;
      font-weight: bold;
      color: inherit;
    }
    .cell-highlight {
      display: block;
      font-size: 2em;
      font-weight: bold;
      padding: 10px 20px;
      background-color: #ff3c00;
      color: #fff;
      border-radius: 8px;
      margin: 5px auto;
      transition: background-color 0.3s;
    }
    .confirmed-cell {
      background-color: #28a745 !important;
    }
    .status-text {
      text-align: center;
      font-size: 1.1em;
      color: #888;
      margin-top: 5px;
    }
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ê—Ä—Ç–∏–∫—É–ª, –†–∞/–†–æ, –®—Ç—É–∫) */
    .info-cards {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .info-card {
      background: #ff3c00;
      color: #fff;
      border-radius: 8px;
      width: 100px;
      height: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      transition: background 0.3s;
    }
    .info-card:hover {
      background: #ff5722;
    }
    .card-label {
      font-size: 0.7em;
      opacity: 0.9;
    }
    .card-value {
      font-size: 1.1em;
      font-weight: bold;
      margin-top: 3px;
    }
    /* –ë–ª–æ–∫ "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" */
    .quantity-block {
      text-align: center;
      margin-top: 15px;
      position: relative;
    }
    .quantity-block input[type="number"] {
      width: 100px;
      padding: 10px;
      font-size: 1.3em;
      border: 2px solid #ccc;
      border-radius: 6px;
      margin-right: 10px;
      transition: border-color 0.3s;
    }
    .quantity-block input[type="number"]:focus {
      border-color: #ff3c00;
      outline: none;
    }
    .quantity-block .btn {
      padding: 10px 20px;
      font-size: 1.3em;
      background: linear-gradient(135deg, #FF3366, #FF7733);
      border: none;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: background 0.3s, transform 0.2s;
    }
    .quantity-block .btn:disabled {
      background: #aaa;
      cursor: not-allowed;
    }
    .quantity-block .btn:hover:not(:disabled) {
      background: linear-gradient(135deg, #FF2255, #FF6633);
      transform: translateY(-2px);
    }
    .back-btn-qty {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff6a00, #ee0979);
      color: #fff;
      font-size: 1.8em;
      cursor: pointer;
      outline: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      transition: background 0.3s, transform 0.2s;
    }
    .back-btn-qty:hover {
      background: linear-gradient(135deg, #e05500, #d80a70);
      transform: scale(1.05);
    }
    /* –ù–∏–∂–Ω–∏–π –±–ª–æ–∫ –∫–Ω–æ–ø–æ–∫ */
    .bottom-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 20px;
    }
    .back-btn, .skip-btn {
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 1.1em;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.3s;
      flex: 1;
      text-align: center;
    }
    .back-btn {
      background: #333;
      color: #fff;
    }
    .back-btn:hover {
      background: #555;
    }
    .skip-btn {
      background: #007bff;
      color: #fff;
      border: none;
    }
    .skip-btn:hover {
      background: #0056b3;
    }

    /* 1) –û–±—â–∏–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ü–∏–π */
.transfer-section .section-info,
.transfer-section .edit-btn {
  position: absolute;
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, #ff3c00, #ff7733);
  color: #fff;
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2em;
  cursor: pointer;
  transition: transform .2s, background .2s;
  z-index: 10;
}
/* info —Å–ª–µ–≤–∞, edit —Å–ø—Ä–∞–≤–∞ */
.transfer-section .section-info {
  top: 8px;
  left: 8px;
}
.transfer-section .edit-btn {
  top: 8px;
  right: 8px;
}
/* hover‚Äë—ç—Ñ—Ñ–µ–∫—Ç */
.transfer-section .section-info:hover,
.transfer-section .edit-btn:hover {
  transform: scale(1.1);
  background: linear-gradient(135deg, #e04400, #ff5733);
}

/* 2) –ö—Ä–∞—Å–∏–≤—ã–π, –ª—ë–≥–∫–∏–π popup‚Äë–±–ª–æ–∫ */
.section-popup {
  display: none;
  position: absolute;
  border: 1.5px solid #ff3c00;
  top: 42px;        /* –ø–æ–¥ 32px‚Äë–∫–Ω–æ–ø–∫–æ–π + 8px –æ—Ç—Å—Ç—É–ø */
  left: 8px;        /* —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ª–µ–≤—ã–º –æ—Ç—Å—Ç—É–ø–æ–º –∫–Ω–æ–ø–∫–∏ ‚ùî */
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.1);
  padding: 12px;
  z-index: 20;
  min-width: 200px;
}

/* –¢–∞–±–ª–∏—Ü–∞ –≤–Ω—É—Ç—Ä–∏ pop‚Äëup, –∑–µ–±—Ä–∞‚Äë—à–∞–±–ª–æ–Ω, —á–∏—Ç–∞–µ–º–æ—Å—Ç—å */
.section-popup table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9em;
}
.section-popup th,
.section-popup td {
  padding: 8px 10px;
  text-align: left;
}
.section-popup th {
  background: #ff3c00;
  color: #fff;
  font-weight: 600;
  border-bottom: 2px solid #e0e0e0;
}
.section-popup tr:nth-child(odd) {
  background: #f9f9f9;
}
.section-popup tr:nth-child(even) {
  background: #fff;
}
.filter-btn {
  position: absolute;
  top: 10px;
  left: 10px;
  width: 42px;
  height: 42px;
  background: linear-gradient(135deg,#ff3c00,#ff7733);
  border: none;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 10;
}
.filter-btn svg {
  width: 22px;
  height: 22px;
  fill: #fff;
}
.filter-menu {
  display: none;
  position: absolute;
  top: 60px;
  left: 10px;
  background: #fff;
  border: 2px solid #ff3c00;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,.2);
  z-index: 99;
  padding: 8px 0;
  min-width: 240px;
}
.filter-option {
  padding: 12px 16px;
  font-size: 1rem;
  color: #333;
  cursor: pointer;
  transition: background 0.2s ease;
}
.filter-option:hover {
  background: #ffe0d3;
}
.filter-choice {
    display: block;
    background: linear-gradient(135deg, #ff3c00, #ff7733);
    color: #fff;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    border-radius: 10px;
    padding: 12px;
    margin: 6px 0;
    transition: background 0.3s, transform 0.2s;
  }
  .filter-choice:hover {
    background: linear-gradient(135deg, #e04400, #ff5733);
    transform: scale(1.05);
  }
  
  .circle-back {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: linear-gradient(135deg, #ff3c00, #ff7733);
  color: #fff;
  font-size: 1.2em;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.transfer-section.quantity-block.grayed {
  opacity: 0.5;
  pointer-events: none;
}
/* –ö–Ω–æ–ø–∫–∞ ¬´–ù–∞–∑–∞–¥¬ª –æ—Å—Ç–∞—ë—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π */
.transfer-section.quantity-block.grayed .circle-back {
  opacity: 1;
  pointer-events: auto;
}
/* –ö–ª–∞—Å—Å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –±–ª–æ–∫–∞ */
.hidden {
  display: none;
}

/* –ö–ª–∞—Å—Å –¥–ª—è ¬´–∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è¬ª –±–ª–æ–∫–∞ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ */
.grayed {
  opacity: 0.5;
  pointer-events: none;
}
/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ—Ö —Ç—Ä—ë—Ö –∫–Ω–æ–ø–æ–∫ */
.buttons-block {
  width: 100%;
  max-width: 600px;
  margin: 0 auto 2em;
  box-sizing: border-box;
}

/* –ü–µ—Ä–≤—ã–π —Ä—è–¥: –¥–≤–µ –∫–Ω–æ–ø–∫–∏ —Ä—è–¥–æ–º */
.buttons-row {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}
.buttons-row a {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
  padding: .8em 0;
  border-radius: 6px;
  color: #fff;
  font-size: 1.2em;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  transition: background .3s, transform .1s;
}

/* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
.btn-primary {
  background: linear-gradient(135deg, #33a7ff, #a0e1ff);
}
.btn-primary:hover {
  background: linear-gradient(135deg, #14d0ff, #02a2ff);
}

/* –ß—ë—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
.btn-secondary,
.complete-btn {
  background: #333;
}
.btn-secondary:hover,
.complete-btn:hover {
  background: #555;
}
.complete-btn {
  display: block;
  width: 100%;
  padding: .8em 0;
  margin: 0;
  border: none;
  border-radius: 6px;
  color: #fff;
  font-size: 1.2em;
  text-align: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  transition: background .3s, transform .1s;
}
/* –§–∏–∫—Å–∏—Ä—É–µ–º ¬´–æ—Ä–∞–Ω–∂–µ–≤—ã–π¬ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
.transfer-container {
  position: fixed;      /* –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫ –æ–∫–Ω—É */
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  padding: 5px;        /* –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –æ—Ç –≥—Ä–∞–Ω–∏—Ü */
  box-sizing: border-box;
  overflow-y: auto;     /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
  overflow-x: hidden;   /* –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –Ω–µ –±—É–¥–µ—Ç */
}

/* –û—Ç–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª —É html/body */
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  height: 100%;
}

/* 2) –ë–ª–æ–∫ —Å–∫–∞–Ω–æ–≤ */
.scan-block {
  position: relative;
  padding: 20px;
  background: #fff8e1;
  border: 2px solid #ffd700;
  border-radius: 8px;
  text-align: center;
}

/* –û–±—â–∏–π —Å—Ç–∏–ª—å –¥–ª—è —Ç—Ä—ë—Ö –∏–∫–æ–Ω–æ–∫ –≤ —É–≥–ª–∞—Ö */
.scan-block .icon-btn {
  position: absolute;
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, #ff3c00, #ff7733);
  border: none;
  border-radius: 50%;
  color: #fff;
  font-size: 1.2em;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform .2s, background .3s;
  z-index: 2;
}
.scan-block .icon-btn:hover {
  transform: scale(1.1);
  background: linear-gradient(135deg, #e04400, #ff5733);
}

/* —Ç–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ñ–æ –∏ –Ω–∞–∑–∞–¥ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö quantitySection */
#quantitySection .section-info {
  position: absolute;
  top: 8px;
  left: 8px;
}
#quantitySection .circle-back {
  position: absolute;
  top: 8px;
  right: 8px;
}


/* 3) –°—Ç–µ—Ä–µ—Ç—å —Å–∫–∞–Ω—ã –≤ —Å–∞–º–æ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É */
.scan-block #clearScansBtn {
  top: 10px;
  right: 10px;
}

/* Popup-–æ–∫–Ω–æ –Ω–∞–¥ scan-block */
.section-popup {
  position: absolute;
  top: 8px;      /* —á—É—Ç—å –Ω–∏–∂–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å–µ–∫—Ü–∏–∏ */
  left: 8px;     /* –≤—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π ‚ùî */
  z-index: 10;   /* –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ –≤–Ω—É—Ç—Ä–∏ scan-block */
  display: none;
  background: #fff;
  border: 1px solid #ff3c00;
  border-radius: 6px;
  padding: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.section-popup .close-popup {
  position: absolute;
  top: 4px;
  right: 4px;
  border: none;
  background: none;
  font-size: 1.2em;
  cursor: pointer;
}


/* –°–ø–∏—Å–æ–∫ —Å–∫–∞–Ω–æ–≤ –ø–æ —Ü–µ–Ω—Ç—Ä—É, –∂–∏—Ä–Ω—ã–π */
.scan-block .info-block {
  list-style: none;
  padding: 0;
  margin: 50px 0 0;
  font-weight: bold;
}
.source-section .info-block {
  margin-top: 10px;  /* –∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –≤–∫—É—Å—É */
}
/* –ö–Ω–æ–ø–∫–∞ "–ì–æ—Ç–æ–≤–æ" –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ .done-block */
.done-block {
  text-align: center;
  margin-top: 20px;
}
/* –ë–ª–æ–∫ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏ */
#printCountInput.manual-input {
  position: absolute;

  top: 60px;         /* –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π –ø–µ—á–∞—Ç–∏ */
  right: 10px;
  background: #fff;
  border: 2px solid #ccccccc7;
  padding: 8px;
  border-radius: 6px;
  display: none;
  z-index: 5;
}
#printCountInput.manual-input input {
  width: 80px;
  margin-right: 6px;
}
#printCountInput.manual-input .btn.cancel {
  background: #aaa;
  margin-left: 4px;
}
/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, –∫–æ–≥–¥–∞ –Ω–µ—Ç hidden */
#printCountInput:not(.hidden) { display: flex; align-items: center; }
/* –ö–Ω–æ–ø–∫–∞ –ø–µ—á–∞—Ç–∏ –≤ —à–∞–ø–∫–µ ‚Äî –∫—Ä—É–≥–ª–∞—è, –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É */
#printLabelBtn {
  position: absolute;
  top: 60px;     /* –ø–æ–¥ info-–∫–Ω–æ–ø–∫–æ–π, —Å–º–µ—Å—Ç–∏—Ç—å –≤–Ω–∏–∑ */
  right: 10px;    /* –≤—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ info */
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #ff3c00, #ff7733);
  color: #fff;
  border: none;
  border-radius: 50%;
  font-size: 1.5em;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 4;
  transition: background 0.3s, transform 0.2s;
}
#printLabelBtn:hover {
  background: linear-gradient(135deg, #e04400, #ff5733);
  transform: scale(1.1);
}


  </style>
</head>
<body>
  
  <div class="transfer-container">
    <!-- –í–µ—Ä—Ö–Ω—è—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –∫–Ω–æ–ø–∫–∞ info -->
    <div class="header-info">
      <div class="static-header">
        –ü–µ—Ä–µ–Ω–æ—Å<br>—Ç–æ–≤–∞—Ä–∞
      </div>
      <div class="remaining-tasks">
        –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–¥–∞—á: {{ remaining_tasks }}
      </div>
    </div>
    <button class="info-icon" id="infoIcon" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">‚ÑπÔ∏é</button>

        <!-- 1) –ö–Ω–æ–ø–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ -->
        <button id="filterBtn" class="filter-btn" title="–§–∏–ª—å—Ç—Ä">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M3 5h18v2H3zm4 6h10v2H7zm2 6h6v2H9z"/>
          </svg>
        </button>
        <div id="filterMenu" class="filter-menu" style="padding: 12px;">
          <a href="{{ url_for('shop_queue', mode='default', queue=queue) }}" class="filter-choice">üì¶ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</a>
          <a href="{{ url_for('shop_queue', mode='articul', queue=queue) }}" class="filter-choice">üî§ –ü–æ –∞—Ä—Ç–∏–∫—É–ª—É</a>
          
        </div>


    <div class="info-popup" id="infoPopup">
      <button class="close-popup" id="closeInfoBtn">√ó</button>
      <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
      <p><strong>–°–∫–ª–∞–¥—Å–∫–∞—è –∑–∞–¥–∞—á–∞:</strong> {{ task.task_number }}</p>
      <p><strong>–î–æ–∫—É–º–µ–Ω—Ç:</strong> {% if task.id_deliveries is defined %}{{ task.id_deliveries }}{% endif %}</p>
      <p><strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong> {{ task.id_orders }}</p>
    </div>
    <!-- –≥–¥–µ-—Ç–æ –≤ header, —Ä—è–¥–æ–º —Å Info –∏ —Ñ–∏–ª—å—Ç—Ä–æ–º -->
    <button id="printLabelBtn" class="icon-btn" title="–ü–µ—á–∞—Ç—å —ç—Ç–∏–∫–µ—Ç–∫–∏">üñ®</button>
    <div id="printCountInput" class="manual-input hidden">
      <input id="printQtyField" type="number" min="1" placeholder="–ö–æ–ª-–≤–æ –∫–æ—Ä–æ–±–æ–∫">
      <button id="printConfirmBtn" class="btn">–ì–æ—Ç–æ–≤–æ</button>
      <button id="printCancelBtn" class="btn cancel">–û—Ç–º–µ–Ω–∞</button>
    </div>



    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
    <div class="product-info">
      <span>{% if task.types %}{{ task.types }}{% else %}–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞{% endif %}</span>
      <span>({{ task.gender }} / {{ task.model }} / {{ task.color }})</span>
    </div>



    <section id="quantitySection" class="transfer-section hidden">
      <h2>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ..</h2>

      <button class="icon-btn section-info" data-target="popup-quantity" title="–ü–æ–º–æ—â—å">‚ùî</button>
      <!-- 2) –ö–Ω–æ–ø–∫–∞ ¬´–ù–∞–∑–∞–¥¬ª -->
      <button class="icon-btn circle-back" id="backToSource" title="–í–µ—Ä–Ω—É—Ç—å—Å—è">‚Üê</button>
    
      <div class="scan-block">
        <!-- 1) –ö–Ω–æ–ø–∫–∞ –∏–Ω—Ñ–æ -->

        <!-- 3) –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–∫–∞–Ω–æ–≤ -->
        <button class="icon-btn" id="clearScansBtn" title="–û—á–∏—Å—Ç–∏—Ç—å —Å–∫–∞–Ω—ã">üóë</button>
    
        <!-- —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, —Å–∞–º —Å–ø–∏—Å–æ–∫ —Å–∫–∞–Ω–æ–≤ -->
        <ul id="scannedList" class="info-block">
          <!-- –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: N –∏ –¥–∞–ª–µ–µ –ø–∞—Ä—ã ‚Äú–∞—Ä—Ç ‚Üí –∫–æ—Ä–æ–±–∫–∞‚Äù -->
        </ul>
      </div>
    
      <!-- Popup-–æ–∫–Ω–æ –¥–ª—è –∏–Ω—Ñ–æ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É -->
      <div id="popup-quantity" class="section-popup">
        <button class="close-popup">√ó</button>
        <table>
          <tr><th>–ê—Ä—Ç–∏–∫—É–ª</th>   <td>{{ task.articul }}</td></tr>
          <tr><th>–†–∞–∑–º–µ—Ä</th>    <td>{{ task.sizes }}</td></tr>
          <tr><th>–†–æ—Å—Ç</th>      <td>{{ task.heights }}</td></tr>
          <tr><th>–†–æ—Å—Ç –≤¬†—Å–º</th> <td>{{ task.heightsrus }}</td></tr>
          <tr><th>–¢–∏–ø</th>       <td>{{ task.types }}</td></tr>
          <tr><th>–ú–æ–¥–µ–ª—å</th>    <td>{{ task.model }}</td></tr>
          <tr><th>–ü–æ–ª</th>       <td>{{ task.gender }}</td></tr>
          <tr><th>–¶–≤–µ—Ç</th>      <td>{{ task.color }}</td></tr>
        </table>
      </div>
    
      <!-- –ë–æ–ª—å—à–∞—è –∫–Ω–æ–ø–∫–∞ ¬´–ì–æ—Ç–æ–≤–æ¬ª –ø–æ —Ü–µ–Ω—Ç—Ä—É -->
      <div class="done-block">
        <button id="doneBtn" class="complete-btn" disabled>–ì–æ—Ç–æ–≤–æ</button>
      </div>
    
      <!-- –ö–Ω–æ–ø–∫–∞ ¬´–î–∞–ª—å—à–µ¬ª –ø–æ–¥ ¬´–ì–æ—Ç–æ–≤–æ¬ª -->
      <div class="next-block">
        <button id="nextBtn" class="complete-btn" style="display:none;">–î–∞–ª—å—à–µ</button>
      </div>
    </section>
    
    
    <!-- –°–µ–∫—Ü–∏—è "–û—Ç–∫—É–¥–∞" -->
    <div class="transfer-section source-section active" id="sourceSection">
      <button class="section-info" data-target="popup-source">‚ùî</button>
      <div id="popup-source" class="section-popup">
        <table>
          <tr><th>–ê—Ä—Ç–∏–∫—É–ª</th>   <td>{{ task.articul }}</td></tr>
          <tr><th>–†–∞–∑–º–µ—Ä</th>    <td>{{ task.sizes }}</td></tr>
          <tr><th>–†–æ—Å—Ç</th>      <td>{{ task.heights }}</td></tr>
          <tr><th>–†–æ—Å—Ç –≤¬†—Å–º</th> <td>{{ task.heightsrus }}</td></tr>
          <tr><th>–¢–∏–ø</th>       <td>{{ task.types }}</td></tr>
          <tr><th>–ú–æ–¥–µ–ª—å</th>    <td>{{ task.model }}</td></tr>
          <tr><th>–ü–æ–ª</th>       <td>{{ task.gender }}</td></tr>
          <tr><th>–¶–≤–µ—Ç</th>      <td>{{ task.color }}</td></tr>
        </table>
      </div>
      <h2>–û—Ç–∫—É–¥–∞
        <button class="edit-btn" id="editSourceBtn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé</button>
      </h2>
      <div class="info-block">
        <span class="label">–Ø—á–µ–π–∫–∞:</span>
        <strong id="sourceCell" class="cell-highlight">{{ task.from_cell }}</strong>
      </div>
      <div id="manualSourceInput" class="manual-input">
        <input type="text" id="sourceInputField" placeholder="–í–≤–µ–¥–∏—Ç–µ —è—á–µ–π–∫—É">
        <button id="saveSourceBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="cancelSourceBtn" style="background: #aaa;">–û—Ç–º–µ–Ω–∞</button>
      </div>
      <div class="info-cards">
        <div class="info-card" id="articulCard">
          <div class="card-label">–ê—Ä—Ç–∏–∫—É–ª</div>
          <div class="card-value" id="article">{{ task.articul }}</div>
        </div>
        <div class="info-card" id="sizeCard">
          <div class="card-label">–†–∞/–†–æ</div>
          <div class="card-value" id="sizeHeightValue">{{ task.sizes }}/{{ task.heightsrus }}</div>
        </div>
        <div class="info-card" id="countCard">
          <div class="card-label">–®—Ç—É–∫</div>
          <div class="card-value" id="plannedQuantityValue">{{ task.counts }}</div>
        </div>
      </div>
      <p id="sourceStatus" class="status-text"></p>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" -->
    <!-- –°–µ–∫—Ü–∏—è "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—á—ë—Ç—á–∏–∫) -->


    
    
    
    <div class="buttons-block">
    <!-- –†—è–¥ –∏–∑ –¥–≤—É—Ö –∫–Ω–æ–ø–æ–∫ -->
    <div class="buttons-row">
      <a id="skipBtn"
         class="btn-primary"
         href="{{ url_for('shop_queue', skip=task.task_number, queue=queue) }}">
        –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
      </a>
      {% if request.args.get('mode') %}
        <a class="btn-secondary"
           href="{{ url_for('queue_turn',
                           turn=queue) }}">
          –í–µ—Ä–Ω—É—Ç—å—Å—è
        </a>
      {% else %}
        <a class="btn-secondary"
           href="{{ url_for('queue_turn', turn=queue) }}">
          –í–µ—Ä–Ω—É—Ç—å—Å—è
        </a>
      {% endif %}
    </div>
  
    <!-- –ü–æ–¥ –Ω–∏–º–∏ ‚Äî –æ–¥–Ω–∞ –±–æ–ª—å—à–∞—è –∫–Ω–æ–ø–∫–∞ -->
    <form method="post" action="{{ url_for('split_order') }}">
      <input type="hidden" name="order_id" value="{{ task.id_orders }}">

      <input type="hidden" name="turn"     value="{{ queue }}">
      <input type="hidden" name="mode"     value="{{ request.args.get('mode','') }}">
      <button type="submit" class="complete-btn">
        –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É
      </button>
    </form>
    
  </div>

  
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —Å–µ–∫—Ü–∏–∏ ---
      const TASK_ID         = parseInt("{{ task.task_number }}", 10);
      const sourceSection   = document.getElementById('sourceSection');
      const quantitySection = document.getElementById('quantitySection');
      const scanInput       = document.getElementById('scanInput');
      let step = 'source';
      let items = [], boxScanned = false;
      let currentItems = [];    // —Ç–æ–≤–∞—Ä—ã, –µ—â—ë –Ω–µ —É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ –≤ –∫–æ—Ä–æ–±–∫—É
      let cycles       = [];    // –º–∞—Å—Å–∏–≤ —É–ø–∞–∫–æ–≤–æ—á–Ω—ã—Ö ¬´—Ü–∏–∫–ª–æ–≤¬ª: { items: [‚Ä¶], box: { boxId, caseNum } }


    
      function showSection(name) {
        sourceSection.classList.toggle('active',  name === 'source');
        sourceSection.classList.toggle('hidden',  name !== 'source');
        quantitySection.classList.toggle('active', name === 'quantity');
        quantitySection.classList.toggle('hidden', name !== 'quantity');
        step = name;
        if (name === 'quantity') quantitySection.scrollIntoView({ behavior: 'smooth' });
        scanInput?.focus();
      }
    
      // --- Info-popup ‚ÑπÔ∏é ---
      const infoIcon     = document.getElementById('infoIcon');
      const infoPopup    = document.getElementById('infoPopup');
      const closeInfoBtn = document.getElementById('closeInfoBtn');
      infoIcon.addEventListener('click', e => {
        e.stopPropagation();
        infoPopup.style.display = infoPopup.style.display === 'block' ? 'none' : 'block';
      });
      closeInfoBtn?.addEventListener('click', () => infoPopup.style.display = 'none');
      document.addEventListener('click', () => infoPopup.style.display = 'none');
    
      // --- –§–∏–ª—å—Ç—Ä –∑–∞–¥–∞—á ---
      const filterBtn  = document.getElementById('filterBtn');
      const filterMenu = document.getElementById('filterMenu');
      filterBtn.addEventListener('click', e => {
        e.stopPropagation();
        filterMenu.style.display = filterMenu.style.display === 'block' ? 'none' : 'block';
      });
      document.addEventListener('click', e => {
        if (!filterBtn.contains(e.target) && !filterMenu.contains(e.target))
          filterMenu.style.display = 'none';
      });
    
      // --- Section-info (‚ùî) –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ ---
      document.querySelectorAll('.section-info').forEach(btn => {
        const popup = document.getElementById(btn.dataset.target);
        btn.addEventListener('click', e => {
          e.stopPropagation();
          popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
        });
      });
      document.addEventListener('click', () => {
        document.querySelectorAll('.section-popup').forEach(p => p.style.display = 'none');
      });
      // --- –ü–µ—á–∞—Ç—å —ç—Ç–∏–∫–µ—Ç–∫–∏: –æ—Ç–∫—Ä—ã—Ç—å –≤–≤–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ ---
    const printBtn      = document.getElementById('printLabelBtn');
    const printInputDiv = document.getElementById('printCountInput');
    const printField    = document.getElementById('printQtyField');
    const printOkBtn    = document.getElementById('printConfirmBtn');
    const printCancel   = document.getElementById('printCancelBtn');



    printBtn.addEventListener('click', e => {
      e.stopPropagation();
      printInputDiv.classList.toggle('hidden');
      if (!printInputDiv.classList.contains('hidden')) {
        printField.value = '';
        printField.focus();
      }
    });

    // –û—Ç–º–µ–Ω–∞ –≤–≤–æ–¥–∞
    printCancel.addEventListener('click', () => {
      printInputDiv.classList.add('hidden');
    });

    // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –ø–µ—á–∞—Ç—å
    printOkBtn.addEventListener('click', async () => {
      const cnt = parseInt(printField.value, 10);
      if (!cnt || cnt < 1) {
        Swal.fire({
          icon: 'error',
          title: '–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ!',
          toast: true, position: 'top-end',
          timer: 2000, showConfirmButton: false
        });
        return;
      }
      printInputDiv.classList.add('hidden');
      try {
        const res = await fetch('/shop_queue/print_box', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({count: cnt})
        });
        const js  = await res.json();
        Swal.fire({
          icon: js.status==='success'?'success':'error',
          title: js.status==='success'?'–ü–µ—á–∞—Ç—å –∑–∞–ø—É—â–µ–Ω–∞':('–û—à–∏–±–∫–∞: '+(js.error||js.message)),
          toast: true, position: 'top-end',
          timer: 1500, showConfirmButton: false
        });
      } catch {
        Swal.fire({
          icon: 'error',
          title: '–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏',
          toast: true, position: 'top-end',
          timer: 2000, showConfirmButton: false
        });
      }
    });
      document.querySelectorAll('.section-popup .close-popup').forEach(x => {
        x.addEventListener('click', e => {
          const popup = x.closest('.section-popup');
          popup.style.display = 'none';
        });
      });
    
      // 3) –ö–ª–∏–∫ –≤–Ω–µ –ª—é–±–æ–≥–æ –ø–æ–ø–∞–ø–∞ ‚Äì –ø—Ä—è—á–µ–º –≤—Å—ë
      document.addEventListener('click', () => {
        document.querySelectorAll('.section-popup').forEach(p => {
          p.style.display = 'none';
        });
      });
    
      // --- –†—É—á–Ω–æ–π –≤–≤–æ–¥ ¬´–û—Ç–∫—É–¥–∞¬ª ---
      const editSourceBtn     = document.getElementById('editSourceBtn');
      const manualSourceInput = document.getElementById('manualSourceInput');
      const sourceInputField  = document.getElementById('sourceInputField');
      const saveSourceBtn     = document.getElementById('saveSourceBtn');
      const cancelSourceBtn   = document.getElementById('cancelSourceBtn');
      const sourceStatusEl    = document.getElementById('sourceStatus');
      const sourceCellElem    = document.getElementById('sourceCell');
    
      editSourceBtn.addEventListener('click', e => {
        e.stopPropagation();
        manualSourceInput.style.display = manualSourceInput.style.display === 'block' ? 'none' : 'block';
        if (manualSourceInput.style.display === 'block') {
          sourceInputField.value = '';
          sourceInputField.focus();
          editSourceBtn.classList.add('active');
        } else {
          editSourceBtn.classList.remove('active');
        }
      });
      cancelSourceBtn.addEventListener('click', () => {
        manualSourceInput.style.display = 'none';
        sourceStatusEl.textContent = '';
        editSourceBtn.classList.remove('active');
      });
      saveSourceBtn.addEventListener('click', async () => {
        const cell = sourceInputField.value.trim();
        if (!cell) {
          sourceStatusEl.textContent = '–í–≤–µ–¥–∏—Ç–µ —è—á–µ–π–∫—É!';
          return;
        }
        const res = await fetch('/shop_queue/validate_source', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({cell_code: cell, task_id: TASK_ID})
        });
        const js = await res.json();
        if (js.status === 'success') {
          sourceCellElem.textContent = cell;
          sourceCellElem.classList.add('confirmed-cell');
          sourceSection.classList.add('confirmed');
          manualSourceInput.style.display = 'none';
          sourceStatusEl.textContent = '';
          editSourceBtn.classList.remove('active');
          showSection('quantity');
        } else {
          sourceStatusEl.textContent = js.message;
        }
      });
    
      // --- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–µ–∫—Ü–∏–∏ ¬´–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ¬ª ---
      const scannedList   = document.getElementById('scannedList');
      const clearScansBtn = document.getElementById('clearScansBtn');
      const printLabelBtn = document.getElementById('printLabelBtn');
      const doneBtn       = document.getElementById('doneBtn');
    
      clearScansBtn.onclick = () => {
        currentItems = [];
        cycles = [];
        renderCycles();
        doneBtn.disabled = true;
      };

      // –≤–æ–∑–≤—Ä–∞—Ç –∫ –±–ª–æ–∫—É ¬´–û—Ç–∫—É–¥–∞¬ª
    document.getElementById('backToSource').addEventListener('click', () => {
      showSection('source');
    });


    



    

    
    document.addEventListener('keydown', async e => {
      if (e.key !== 'Enter' || step !== 'quantity') return;
      const code = (e.target.value||'').trim() || prompt('–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∫–æ–¥:');
      if (!code) return;
    
      // —à–ª—ë–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –∂–¥—ë–º, —á—Ç–æ –≤–µ—Ä–Ω—ë—Ç js.type –∏ js.record
      const res = await fetch('/shop_queue/scan', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ code, step:'quantity' })
      });
      const js = await res.json();
      if (js.status !== 'success') {
        alert(js.message);
        return;
      }
    
      if (js.type === 'item') {
        // –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
        currentItems.push(js.record);
      } else {
        // –∫–æ—Ä–æ–±–∫–∞: –∑–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ü–∏–∫–ª
        if (currentItems.length === 0) {
          alert('–°–Ω–∞—á–∞–ª–∞ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –¥–ª—è —ç—Ç–æ–π –∫–æ—Ä–æ–±–∫–∏');
          return;
        }
        cycles.push({ items: currentItems.slice(), box: js.record });
        currentItems = [];
      }
    
      renderCycles();                   // —Ä–∏—Å—É–µ–º —Å–ø–∏—Å–æ–∫ —É–ø–∞–∫–æ–≤–æ–∫ + –Ω–µ–∑–∞–±–æ–∫—Å–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
      doneBtn.disabled = cycles.length === 0; // ¬´–ì–æ—Ç–æ–≤–æ¬ª –¥–æ—Å—Ç—É–ø–Ω–æ, –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∫–æ—Ä–æ–±–∫–∞
    });
    function renderCycles() {
      const list = cycles.map(c => {
        const names = c.items.map(it => it.articul).join(', ');
        return `<li>–ö–æ—Ä–æ–±–∫–∞ ${c.box.caseNum}: ${names}</li>`;
      }).join('');
      const tail = currentItems.map(it => `<li>‚Üí ${it.articul}</li>`).join('');
      scannedList.innerHTML = list + tail;
    }
    
    
      function renderList() {
        scannedList.innerHTML =
          `<li>–û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: ${items.length}</li>` +
          items.map(it => `<li>${it.articul} ‚Üí ${it.boxBarcode||'‚Ä¶'}</li>`).join('');
      }
    
      // --- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π ---
      doneBtn.onclick = () => {
        quantitySection.classList.add('grayed');
        clearScansBtn.disabled = printLabelBtn.disabled = doneBtn.disabled = true;
        nextBtn.style.display = 'inline-block';
      };
    
      nextBtn.onclick = async () => {
        const res = await fetch('/shop_queue/update_task', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ cycles })
        });
        const js = await res.json();
        if (js.status === 'success') window.location.reload();
        else alert('–û—à–∏–±–∫–∞: ' + js.error || js.message);
      };
      
    
      // --- –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å/–í–µ—Ä–Ω—É—Ç—å—Å—è ---
      document.getElementById('skipBtn').addEventListener('click', e => {
        e.preventDefault();
        window.location.href = e.currentTarget.href;
      });
      document.querySelector('.btn-secondary').addEventListener('click', e => {
        e.preventDefault();
        window.location.href = e.currentTarget.href;
      });
    
      // --- –ù–∞—á–∞–ª—å–Ω—ã–π —Ñ–æ–∫—É—Å ---
      scanInput?.focus();
    });
    </script>
    
    
    
</body>
</html>
